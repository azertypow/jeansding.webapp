import{d as k,s as v,i as C,_ as b,o as i,c as n,A as L,j as A,r as p,a as m,F as _,b as g,e as d,t as S,f as T,w as j,n as E,g as f,h as M}from"./index.b1c77964.js";const I=k({name:"ArticleBlock",components:{},data(){return{footNoteElements:[]}},props:{html:{required:!0,type:String}},async mounted(){this.$refs.articleBlockContainer.append(await this.getArticleContentHtmlElement())},beforeUnmount(){v().clearFootNoteListAndRemoveScrollListener()},computed:{htmlCleanGallery(){const e=document.createElement("div");if(e.innerHTML=this.html,!(e instanceof HTMLElement))return"";const t=e.querySelectorAll("figure");for(const r of t){const c=document.createElement("div");c.className="jd-gallery-img";const a=document.createElement("div");a.className="jd-gallery-img__cursor",c.appendChild(a),r.querySelectorAll("img").forEach(h=>{c.appendChild(h.cloneNode(!0))}),[...r.querySelectorAll("img")].length===1&&c.classList.add("not-gallery"),e.insertBefore(c,r),r.remove()}return e.innerHTML}},methods:{getMousePositionRelativeToTheGallery(e,t){return(e.clientX-t.getBoundingClientRect().x)*100/t.getBoundingClientRect().width<50?"left":"right"},async mouseClickGallery(e,t){this.getMousePositionRelativeToTheGallery(e,t)==="right"?this.galleryScrollToLeft(t):this.galleryScrollToRight(t)},galleryScrollToLeft(e){const t=e.querySelectorAll("img");for(const r of t)if(r.getBoundingClientRect().x>e.getBoundingClientRect().x+10){e.scrollTo({left:r.offsetLeft,behavior:"smooth"});break}},galleryScrollToRight(e){const t=[...e.querySelectorAll("img")].reverse();for(const r of t)if(r.getBoundingClientRect().x<e.getBoundingClientRect().x-10){e.scrollTo({left:r.offsetLeft,behavior:"smooth"});break}},async mouseOverGallery(e,t){const r=t.querySelector(".jd-gallery-img__cursor");r instanceof HTMLElement&&(this.getMousePositionRelativeToTheGallery(e,t)==="left"?r.innerHTML="&larr;":r.innerHTML="&rarr;",r.style.transform=`translate(${e.clientX}px, ${e.clientY}px)`)},async getArticleContentHtmlElement(){const t=new DOMParser().parseFromString(`<div class="v-article-block__html"  >${this.htmlCleanGallery}</div>`,"text/html");t.querySelectorAll("article-footnote").forEach(o=>{v().pushFooterNoteElement(t,o),o.remove()});const r=t.querySelectorAll("img"),a=`mediapage/${this.$router.currentRoute.value.fullPath.replace("/projects/","")}`;for(const o of r){const l=o.src.split("/").pop()||"";o.classList.add("is-loading"),o.src="",C({articleName:a,fileName:l}).then(u=>{o.src=u.resize.tiny;const s=new Image;s.src=u.resize.reg,s.addEventListener("load",()=>{o.src=s.src,o.classList.add("is-load")})})}const h=t.querySelectorAll("figure");return Object.values(h).forEach(o=>{o.querySelectorAll("ul > li > img").length===1&&o.classList.add("ts-article-block-has-only-one-image")}),t.querySelectorAll(".jd-gallery-img").forEach(o=>{o instanceof HTMLElement&&(o.addEventListener("mousemove",l=>this.mouseOverGallery(l,o)),o.addEventListener("mouseenter",()=>{const l=o.querySelector(".jd-gallery-img__cursor");l instanceof HTMLElement&&(l.style.display="block")}),o.addEventListener("mouseleave",()=>{const l=o.querySelector(".jd-gallery-img__cursor");l instanceof HTMLElement&&(l.style.display="none")}),o.addEventListener("click",l=>this.mouseClickGallery(l,o)))}),t.body.firstElementChild}}});const $={class:"v-article-block",ref:"articleBlockContainer"};function w(e,t,r,c,a,h){return i(),n("div",$,null,512)}const H=b(I,[["render",w]]),B=k({components:{ArticleBlock:H,ArticleContainer:L},data(){return{globalState:v(),video:""}},mounted(){this.$nextTick(()=>{this.setVideo()})},methods:{async setVideo(){if(!this.currentArticle||this.currentArticle.vimeoLink===null)return null;const e="https://vimeo.com/api/oembed.json?autopip=1&title=0&byline=0&responsive=1&portrait=0&color=A04600&url="+encodeURI(this.currentArticle.vimeoLink);this.video=(await(await window.fetch(e)).json()).html},getShortedItemForColumn(e){const t=[];return Object.values(this.globalState.apiProjects[this.currentSectionUID].children).filter(r=>r.uid!==this.$route.params.articleUid).forEach((r,c)=>{const a=c%e;t[a]=Array.isArray(t[a])?[...t[a],r]:[r]}),t}},computed:{apiProjects(){return this.globalState.apiProjects},currentArticle(){var e;return(e=this.apiProjects[this.projectSection])==null?void 0:e.children["mediapage/"+this.projectSection+"/"+this.articleUid]},italicMarkdownCurrentArticleTitleAndSubtitle(){if(this.currentArticle===null)return null;const e=this.currentArticle.title?A(this.currentArticle.title):"",t=this.currentArticle.subtitle?"<br>"+A(this.currentArticle.subtitle):"";return e+t},projectSection(){return this.$route.params.projectSection},articleUid(){return this.$route.params.articleUid},currentSectionUID(){return this.$route.params.projectSection}}});const P={class:"v-article"},R={class:"v-article__header"},q={key:0,class:"v-article__content"},F=["innerHTML"],N={class:"v-article__content__header"},U=["innerHTML"],G=["innerHTML"],D={key:1},O={class:"v-article__blocks"},V={key:1,class:"v-article__item"},x={class:"v-article__item__coll"},z={class:"v-article__item__grid"},W={class:"v-article__item__coll"},X={class:"v-article__item__grid"},Y={class:"v-article__item__coll"},J={class:"v-article__item__grid"};function K(e,t,r,c,a,h){const o=p("router-link"),l=p("article-block"),u=p("article-container");return i(),n("div",P,[m("header",R,[(i(!0),n(_,null,g(e.apiProjects,(s,y)=>(i(),T(o,{class:E([{"is-active":y===e.currentSectionUID},"jd-button"]),to:"/projects/"+y},{default:j(()=>[M(S(s.title),1)]),_:2},1032,["class","to"]))),256))]),e.currentArticle?(i(),n("div",q,[e.currentArticle.vimeoLink?(i(),n("div",{key:0,class:"v-article__content__vimeo-box",innerHTML:e.video},null,8,F)):d("",!0),m("div",N,[m("div",{class:"v-article__content__description jd-text-max-width-reg",innerHTML:e.currentArticle.description},null,8,U),e.italicMarkdownCurrentArticleTitleAndSubtitle?(i(),n("h1",{key:0,innerHTML:e.italicMarkdownCurrentArticleTitleAndSubtitle},null,8,G)):d("",!0),e.currentArticle.author?(i(),n("h2",D,S(e.currentArticle.author),1)):d("",!0)]),(i(!0),n(_,null,g(e.currentArticle.article_content,s=>(i(),n("div",O,[f(l,{html:s},null,8,["html"])]))),256))])):d("",!0),e.globalState.apiProjects[e.currentSectionUID]?(i(),n("section",V,[m("div",x,[e.getShortedItemForColumn(3)[0]?(i(!0),n(_,{key:0},g(e.getShortedItemForColumn(3)[0],s=>(i(),n("div",z,[f(u,{style:{"border-bottom":"none"},"article-data":s},null,8,["article-data"])]))),256)):d("",!0)]),m("div",W,[e.getShortedItemForColumn(3)[1]?(i(!0),n(_,{key:0},g(e.getShortedItemForColumn(3)[1],s=>(i(),n("div",X,[f(u,{style:{"border-bottom":"none"},"article-data":s},null,8,["article-data"])]))),256)):d("",!0)]),m("div",Y,[e.getShortedItemForColumn(3)[2]?(i(!0),n(_,{key:0},g(e.getShortedItemForColumn(3)[2],s=>(i(),n("div",J,[f(u,{style:{"border-bottom":"none"},"article-data":s},null,8,["article-data"])]))),256)):d("",!0)])])):d("",!0)])}const Z=b(B,[["render",K]]);export{Z as default};
